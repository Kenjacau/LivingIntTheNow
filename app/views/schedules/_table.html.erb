
<% @positions.each do |job| %>
    <th class="positionHead"> <%= job.name %> </th>
    <% @staff.each do |emp| %>

        <% if emp.position.include?(job) then %> 

             <% empShifts = @weekSchedule.where("user_id = ?", emp.id) %>
            
             <% d = @date %>
             <tr>
             <!--Row Header (emp name) -->
             <th class="myTh lg empColumn"> <%= emp.firstName %> <%= emp.lastName %></th>
             
             <!--builds each day for given employee -->
             <% (0..6).each do |i| %>
                 <% d = d.next_day(1) %>
                 <% dayShift = empShifts.where("date = ?", d) %>
                 <!--builds shift entry if it exists-->
                 <% if dayShift.present? %>
 <%= dayShift.first.id %>
                    <td class="myTd lg" id="tag<%= emp.id %>|<%= d %>">
                    <span class="timeText mil_time"  ><%= dayShift.first.startTime.strftime("%I:%M%p") %></span>
                     - <span class="timeText mil_time"><%= dayShift.first.endTime.strftime("%I:%M%p") %></span>
                    <button type="button" class="editBut" data-toggle="modal" data-user="<%= emp.id %>"
                    data-start="<%= dayShift.first.startTime.strftime("%I:%M%p") %>" 
                    data-end="<%= dayShift.first.endTime.strftime("%I:%M%p") %>" data-date="<%= d %>"
                    data-position="<%= job.id %>" 
                    data-remote="<% edit_schedule_path(dayShift.first) %> #modal-edit-fields" href="#myModal" 
                    id="<%= emp.id %>|<%= d %>">Edit Shift</button>
                    
                    <%# link_to "Edit", edit_schedule_path(shift_id: dayShift.first.id), :class => "btn", :id => "modalLaunch", remote: true  %>
                    </td>
                <!--builds shift create button if shift doesn't exist-->
                 <% else %>
                      <td class="myTd lg" id="tag<%= emp.id %>|<%= d %>"><button 
                      type="button" class="createBut" data-user="<%= emp.id %>" data-date="<%= d %>"
                      data-position="<%= job.id %>" data-toggle="modal" href="#myModal">Create Shift</button>
                      </td>
                 <% end %>
             <% end %>
             </tr>
        <% end %>
    <% end %>
<% end %>


